<div class="group-search">
  <nz-input-group>
    <div nz-row [nzGutter]="8">
      <div nz-col nzFlex="3">
        <nz-input-group [nzPrefix]="prefixIcon" nzCompact>
          <input type="text" nz-input placeholder="搜索" [(ngModel)]="searchValue" />
        </nz-input-group>
        <ng-template #prefixIcon>
          <i nz-icon nzType="search"></i>
        </ng-template>
      </div>
      <div nz-col nzFlex="2">
        <button nz-button nzType="primary" nz-dropdown [nzDropdownMenu]="menu">
          <i nz-icon nzType="plus"></i>
          API
          <i nz-icon nzType="down"></i>
        </button>
        <nz-dropdown-menu #menu="nzDropdownMenu">
          <ul nz-menu>
            <li nz-menu-item (click)="onClick({ event: $event, eventName: 'newApi' })">
              <a>新建API</a>
            </li>
            <li nz-menu-item (click)="onClick({ event: $event, eventName: 'newApiTest' })">
              <a>新建测试</a>
            </li>
            <li nz-menu-item (click)="newGroup()">
              <a>新建分组</a>
            </li>
          </ul>
        </nz-dropdown-menu>
      </div>
    </div>
  </nz-input-group>
</div>
<div class="group-tree">
  <nz-tree
    [nzData]="treeNodes"
    [nzSearchValue]="searchValue"
    [nzExpandedKeys]="expandedKeys"
    (nzClick)="treeItemClick($event)"
    (nzExpandChange)="nzEvent($event)"
    nzDraggable
    nzBlockNode
    (nzOnDrop)="treeItemDrop($event)"
    [nzTreeTemplate]="nzTreeTemplate"
  ></nz-tree>
  <ng-template #nzTreeTemplate let-node let-origin="origin">
    <div class="custom-node">
      <div *ngIf="!node.isLeaf">
        <i nz-icon [nzType]="node.isExpanded ? 'folder-open' : 'folder'"></i>
        <span class="folder-name">{{ node.title }}</span>
        <span class="folder-desc">
          <button nz-dropdown [nzDropdownMenu]="groupMenu">
            <i nz-icon nzType="ellipsis" nzTheme="outline"></i>
          </button>
          <nz-dropdown-menu #groupMenu="nzDropdownMenu">
            <ul nz-menu>
              <li nz-menu-item (click)="onClick({ event: $event, eventName: 'newApi'})">
                <a>添加API</a>
              </li>
              <li nz-menu-item (click)="newSubGroup(node)">
                <a>新建子分组</a>
              </li>
              <li nz-menu-item (click)="editGroup(node)">
                <a>编辑</a>
              </li>
              <li nz-menu-item (click)="deleteGroup(node)">
                <a>删除</a>
              </li>
            </ul>
          </nz-dropdown-menu>
        </span>
      </div>
      <div *ngIf="node.isLeaf">
        <span class="file-name">
          <strong *ngIf="node.origin.method">{{ node.origin.method | uppercase }}</strong> {{ node.title }}
        </span>
        <span class="file-desc">
          <button>
            <i
              nz-icon
              nzType="thunderbolt"
              nzTheme="outline"
              (click)="onClick({ event: $event, eventName: 'testApi', node: node })"
            ></i>
          </button>
          <button nz-dropdown [nzDropdownMenu]="apiDataMenu">
            <i nz-icon nzType="ellipsis" nzTheme="outline"></i>
          </button>
          <nz-dropdown-menu #apiDataMenu="nzDropdownMenu">
            <ul nz-menu>
              <li nz-menu-item (click)="onClick({ event: $event, eventName: 'editApi', node: node })">
                <a>编辑</a>
              </li>
              <li nz-menu-item (click)="onClick({ event: $event, eventName: 'copyApi', node: node })">
                <a>复制</a>
              </li>
              <li nz-menu-item (click)="onClick({ event: $event, eventName: 'deleteApi', node: node })">
                <a>删除</a>
              </li>
            </ul>
          </nz-dropdown-menu>
        </span>
      </div>
    </div>
  </ng-template>
</div>
