<div class="h-full py-3 extension-detail flex flex-col" *ngIf="extensionDetail">
  <div class="top-0 z-50 px-2">
    <div class="pb-3">
      <a eo-ng-button nzType="link" (click)="backToList()" class="flex">
        <eo-iconpark-icon name="left" size="16px"></eo-iconpark-icon><span i18n>Back</span>
      </a>
      <div class="flex items-center justify-between">
        <div class="mr-2">
          <nz-avatar nzSize="small" class="!w-[20px] !h-[20px]" [nzShape]="'square'" nzSrc="{{ extensionDetail.logo }}"></nz-avatar>
          <span class="font-bold text-[14px]">{{ extensionDetail.title || extensionDetail.moduleName }}</span>
        </div>
        <ng-container *ngIf="extensionDetail?.installed">
          <eo-ng-switch [(ngModel)]="isEnable" nzSize="small" class="ml-2.5" (ngModelChange)="handleEnableExtension($event)">
          </eo-ng-switch>
        </ng-container>
        <button
          eo-ng-button
          [nzSize]="extensionDetail?.installed ? 'small' : 'default'"
          [nzType]="extensionDetail?.installed ? 'default' : 'primary'"
          class="mt-[8px]"
          [nzLoading]="isOperating"
          (click)="handleInstall()"
        >
          <span *ngIf="extensionDetail?.installed" i18n>Uninstall</span>
          <span *ngIf="!extensionDetail?.installed" i18n>Install</span>
        </button>
      </div>
    </div>
  </div>
  <section class="h-full px-4 max-w-[80vw] mx-auto flex flex-col overflow-hidden">
    <p class="w-full text-[#888] text-[12px]">{{ extensionDetail.description }}</p>
    <eo-ng-tabset
      [(nzSelectedIndex)]="nzSelectedIndex"
      [nzAnimated]="false"
      [class]="{ settings: nzSelectedIndex === 0 && extensionDetail?.features?.configuration }"
      (nzSelectChange)="handleTabChange($event)"
    >
      <!-- Setting -->
      <eo-ng-tab *ngIf="extensionDetail?.features?.configuration && extensionDetail?.installed" i18n-nzTitle nzTitle="Settings">
        <eo-extension-setting
          [configuration]="extensionDetail?.features?.configuration"
          [extName]="extensionDetail.name"
        ></eo-extension-setting>
      </eo-ng-tab>
      <!-- Details -->
      <eo-ng-tab i18n-nzTitle="@@ExtensionDetail" nzTitle="Details">
        <div class="h-full overflow-auto preview_tab">
          <nz-skeleton [nzLoading]="introLoading" [nzActive]="true">
            <eo-shadow-dom class="md-preview" [text]="extensionDetail.introduction" [options]="{ html: true }"> </eo-shadow-dom>
          </nz-skeleton>
        </div>
      </eo-ng-tab>
      <eo-ng-tab i18n-nzTitle nzTitle="Support">
        <nz-descriptions [nzColumn]="1" nzTitle="">
          <nz-descriptions-item i18n-nzTitle nzTitle="Author">{{ extensionDetail.author }}</nz-descriptions-item>
          <nz-descriptions-item i18n-nzTitle nzTitle="Version">{{ extensionDetail.version }} </nz-descriptions-item>
          <nz-descriptions-item *ngIf="extensionDetail.repository?.url" i18n-nzTitle nzTitle="Repository">
            <a [href]="extensionDetail.repository.url.replace('git+', '')" target="_blank">
              {{ extensionDetail.repository.url.replace('git+', '') }}
            </a>
          </nz-descriptions-item>
          <nz-descriptions-item *ngIf="extensionDetail.homepage" i18n-nzTitle nzTitle="Homepage">
            <a [href]="extensionDetail.homepage" target="_blank">{{ extensionDetail.homepage }}</a>
          </nz-descriptions-item>
          <nz-descriptions-item *ngIf="extensionDetail.bugs?.url" i18n-nzTitle nzTitle="BugReport">
            <a [href]="extensionDetail.bugs.url" target="_blank">{{ extensionDetail.bugs.url }}</a>
          </nz-descriptions-item>
        </nz-descriptions>
      </eo-ng-tab>
      <eo-ng-tab *ngIf="changeLog" i18n-nzTitle nzTitle="ChangeLog">
        <nz-skeleton class="preview_tab" [nzLoading]="changelogLoading" [nzActive]="true">
          <eo-shadow-dom *ngIf="!changeLogNotFound" class="md-preview" [text]="changeLog"> </eo-shadow-dom>
          <nz-result nzStatus="info" i18n-nzTitle nzTitle="Changelog failed to load" *ngIf="changeLogNotFound">
            <div nz-result-extra>
              <button eo-ng-button nzType="primary" i18n (click)="fetchChangelog()">Reacquire</button>
            </div>
          </nz-result>
        </nz-skeleton>
      </eo-ng-tab>
    </eo-ng-tabset>
  </section>
</div>
