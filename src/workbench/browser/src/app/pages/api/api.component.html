<nz-layout class="layout">
  <nz-sider
    nzTheme="light"
    [nzWidth]="siderWidth"
    nz-resizable
    [nzMinWidth]="120"
    [nzMaxWidth]="400"
    (nzResize)="onSideResize($event)"
    (nzResizeEnd)="onResizeEnd()"
  >
    <nz-content class="api-container-tabs">
      <eo-ng-tabset
        [ngClass]="{ 'share-group-tabset': store.isShare }"
        nzCentered
        [nzAnimated]="false"
        eo-ng-tabset
        [(nzSelectedIndex)]="tabsIndex"
      >
        <eo-ng-tab [nzTitle]="apiTitle">
          <ng-template #apiTitle>
            <span
              i18n-nzTooltipTitle
              nzTooltipTitle="Collections"
              eoNgFeedbackTooltip
              [nzTooltipMouseEnterDelay]="0.4"
              class="text-lg tab-content"
            >
              <eo-iconpark-icon name="folder-open"></eo-iconpark-icon>
            </span>
          </ng-template>
          <div class="inner-content">
            <eo-api-group-tree></eo-api-group-tree>
          </div>
        </eo-ng-tab>
        <eo-ng-tab [nzTitle]="historyTitle" *ngIf="!store.isShare">
          <ng-template #historyTitle>
            <span
              i18n-nzTooltipTitle
              nzTooltipTitle="History"
              eoNgFeedbackTooltip
              [nzTooltipMouseEnterDelay]="0.4"
              class="text-lg tab-content"
            >
              <eo-iconpark-icon name="history"></eo-iconpark-icon>
            </span>
          </ng-template>
          <eo-history></eo-history>
        </eo-ng-tab>
      </eo-ng-tabset>
      <nz-resize-handle class="vertical container-draggable" nzDirection="right"> </nz-resize-handle>
    </nz-content>
  </nz-sider>
  <nz-content class="inner-content">
    <!--Tab Bar -->
    <nz-header class="flex items-center tabs-bar">
      <eo-tab
        class="flex-1"
        [list]="apiTab.BASIC_TABS"
        [tabStorageKey]="(store.isLocal ? 'local' : store.getCurrentWorkspaceInfo.id) + '_TabCache'"
        [handleDataBeforeCache]="apiTab.handleDataBeforeCache"
        [checkTabCanLeave]="apiTab.componentRef?.checkTabCanLeave"
        (beforeClose)="apiTab.beforeTabClose($event)"
        [addDropDown]="newTabTemplate"
        [titleLabel]="titleLabel"
        #apiTabComponent
      ></eo-tab>
      <eo-ng-dropdown-menu #newTabTemplate>
        <ul nz-menu>
          <li nz-menu-item (click)="apiTabComponent.newTab()">HTTP</li>
          <li nz-menu-item (click)="apiTabComponent.newTab('ws')">Websocket</li>
        </ul>
      </eo-ng-dropdown-menu>
      <ng-template #titleLabel let-item="item">
        <span class="mr-[5px] font-light method-text method_text_{{ item?.extends?.method}}">
          {{ item?.extends?.method}}</span
        >
      </ng-template>
      <!-- Env Select -->
      <div class="flex items-center">
        <eo-ng-select
          [(ngModel)]="envUuid"
          [(nzOpen)]="isOpen"
          (nzOpenChange)="handleEnvSelectStatus($event)"
          [nzDropdownRender]="renderTemplate"
          nzAllowClear
          i18n-nzPlaceHolder="Environment Dropdown placeholder"
          [nzOptions]="renderEnvList"
          nzPlaceHolder="Environment"
          #envSelect
        >
        </eo-ng-select>
        <ng-template #renderTemplate>
          <nz-divider *ngIf="!store.isShare"></nz-divider>
          <a
            *ngIf="!store.isShare"
            class="text-sx manager-env"
            eo-ng-button
            nzType="link"
            (click)="gotoEnvManager()"
            i18n
            >Manage Environment</a
          >
        </ng-template>
        <button
          eo-ng-button
          nzType="text"
          class="flex items-center justify-center mx-1 icon"
          i18n-nzTooltipTitle
          eoNgFeedbackTooltip
          [nzTooltipMouseEnterDelay]="0.8"
          [nzTooltipMouseLeaveDelay]="0"
          nzTooltipTitle="Environment Quick Look"
          nz-popover
          [nzPopoverContent]="envParams"
          nzTooltipPlacement="bottomRight"
          nzPopoverPlacement="bottomRight"
          nzPopoverTrigger="click"
        >
          <eo-iconpark-icon name="preview-open"></eo-iconpark-icon>
        </button>
        <ng-template #envParams>
          <env-list></env-list>
        </ng-template>
      </div>
    </nz-header>
    <!-- Content -->
    <nz-layout class="content_container {{ this.id ? 'has_tab_page' : '' }}">
      <nz-layout>
        <!-- Child Tab Bar -->
        <eo-ng-tabset class="inside_page_tabset" *ngIf="this.id" nzLinkRouter>
          <eo-ng-tab *ngFor="let tab of renderTabs">
            <p *ngIf="web.isWeb && tab.onlyDestop">
              <span *nzTabLink nz-tab-link (click)="goDownload($event)">{{ tab.title }}</span>
            </p>
            <div *ngIf="!web.isWeb || !tab.onlyDestop">
              <a *nzTabLink nz-tab-link [routerLink]="['http/' + tab.routerLink]" queryParamsHandling="merge">
                {{ tab.title }}
                <nz-badge
                  *ngIf="apiTabComponent.getCurrentTab()?.extends?.hasChanged?.[tab.routerLink]"
                  class="ant-badge-theme-color"
                  nzStatus="default"
                ></nz-badge>
              </a>
            </div>
          </eo-ng-tab>
        </eo-ng-tabset>
        <!-- Get router child component by activate -->
        <router-outlet (activate)="onActivate($event)"></router-outlet>
      </nz-layout>
      <!-- Right Sider -->
      <nz-sider
        *ngIf="!store.isShare"
        nz-resizable
        [nzWidth]="rightSiderWidth"
        [nzMaxWidth]="500"
        [nzMinWidth]="RIGHT_SIDER_SHRINK_WIDTH"
        (nzResize)="onRightPanelResize($event)"
      >
        <nz-resize-handle *ngIf="!store.isShare" class="bottom-0 z-10 vertical container-draggable" nzDirection="left">
        </nz-resize-handle>
        <div class="flex h-full">
          <div class="flex flex-col p-2">
            <button
              type="button"
              eo-ng-button
              nzType="text"
              class="flex items-center justify-center"
              [ngClass]="rightSiderWidth > 100 ? 'active' : ''"
              (click)="toggleRightBar('open')"
              eoNgFeedbackTooltip
              [nzTooltipMouseLeaveDelay]="0"
              i18n-nzTooltipTitle="@@Environment Setting"
              nzTooltipTitle="Environment Setting"
            >
              <eo-iconpark-icon name="application"></eo-iconpark-icon>
            </button>
          </div>
          <eo-env class="flex-auto" (statusChange)="toggleRightBar('close')"></eo-env>
        </div>
      </nz-sider>
    </nz-layout>
  </nz-content>
</nz-layout>
