<header class="flex pt-2 px-[10px]">
  <input eo-ng-input type="text" class="px-3 eo-search-input" i18n-placeholder="@@Search" placeholder="Search"
    [(ngModel)]="searchValue" />
  <button *ngIf="!status.isShare" nzType="primary" eo-ng-button class="ml-3" eo-ng-dropdown [nzDropdownMenu]="menu"
    nzPlacement="bottomRight" (click)="operateApiEvent({ event: $event, eventName: 'addAPI' })">
    <eo-iconpark-icon name="plus"></eo-iconpark-icon>
  </button>
  <eo-ng-dropdown-menu #menu="nzDropdownMenu">
    <ul nz-menu>
      <li nz-menu-item (click)="operateApiEvent({ event: $event, eventName: 'addAPI' })">
        <a i18n="@@AddAPI">New API</a>
      </li>
      <li nz-menu-item (click)="addGroup()"><a i18n>New Group</a></li>
      <li nz-menu-item (click)="operateApiEvent({ event: $event, eventName: 'importAPI' })">
        <a i18n>Import API</a>
      </li>
    </ul>
  </eo-ng-dropdown-menu>
</header>

<!-- Custom Group -->
<div class="group_container group-tree pt10">
  <eo-ng-tree-default *ngIf="treeNodes.length" [nzData]="treeNodes" [nzSelectedKeys]="nzSelectedKeys" #apiGroup
    [nzSearchValue]="searchValue" [nzHideUnMatched]="true" [nzExpandedKeys]="expandKeys"
    (nzClick)="clickTreeItem($event)" (nzExpandChange)="toggleExpand()" [nzDraggable]="isEdit" nzBlockNode
    (nzOnDrop)="treeItemDrop($event)" [nzTreeTemplate]="nzTreeTemplate"></eo-ng-tree-default>
  <nz-skeleton [nzLoading]="apiDataLoading && !treeNodes.length" [nzActive]="true">
    <ng-template #nzTreeTemplate let-node let-origin="origin">
      <div [style.--tree-level]="node.level" class="w-full">
        <!-- Folder -->
        <div class="tree_node f_row f_js_ac" *ngIf="!node.isLeaf">
          <div class="overflow-hidden f_row_ac text-ellipsis">
            <div class="width-box" *ngIf="!node.origin.children || !node.origin.children.length"></div>
            <svg class="iconpark-icon">
              <use [attr.href]="'#' + (node.isExpanded ? 'folder-open' : 'folder-close')"></use>
            </svg>
            <span class="text_omit node_title ml-[4px]">{{ node.title }}</span>
          </div>
          <span class="flex tree_node_operate" *ngIf="isEdit" (click)="$event.stopPropagation()">
            <span nz-dropdown nzTrigger="click" [nzDropdownMenu]="groupMenu">
              <eo-iconpark-icon class="mr-[5px]" name="more" size="16px"></eo-iconpark-icon>
            </span>

            <eo-ng-dropdown-menu #groupMenu="nzDropdownMenu" *ngIf="isEdit">
              <ul nz-menu>
                <li nz-menu-item *ngFor="let item of groupItemsMenu;" (click)="item.click({ group: node  })">
                  {{ item.title }}
                </li>
              </ul>
            </eo-ng-dropdown-menu>
          </span>
        </div>
        <!-- Leaf -->
        <div class="tree_node f_row f_js_ac" *ngIf="!node.origin?.isFixed && node.isLeaf">
          <div class="overflow-hidden f_row_ac text-ellipsis">
            <b class="method_text method_text_{{ node.origin.method }} mr-[5px]" *ngIf="node.origin.method">{{
              node.origin.method
              }}</b>
            <span class="text_omit node_title ml-[4px]">{{ node.title }}</span>
          </div>
          <div class="flex tree_node_operate">

            <span eo-ng-dropdown nzTrigger="click" [nzDropdownMenu]="apiMenu" (click)="$event.stopPropagation()">
              <eo-iconpark-icon class="mr-[5px]" name="more" size="16px"></eo-iconpark-icon>
            </span>
            <eo-ng-dropdown-menu #apiMenu="nzDropdownMenu" *ngIf="isEdit">
              <ul nz-menu>
                <li nz-menu-item *ngFor="let item of apiItemsMenu;"
                  (click)="item.click({ group: node, api: apiDataItems[node.key] })">
                  {{ item.title }}
                </li>
              </ul>
            </eo-ng-dropdown-menu>
          </div>
        </div>
      </div>
    </ng-template>

    <nz-empty *ngIf="!treeNodes.length" nzNotFoundImage="simple"> </nz-empty>
  </nz-skeleton>
</div>
